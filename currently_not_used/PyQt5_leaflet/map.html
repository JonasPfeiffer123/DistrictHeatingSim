<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Leaflet.draw and CRS Support</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <style>
        #map {
            position: relative;
            height: 80vh;
            width: 70%;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000; /* Hoher z-index, um das Three.js-Canvas über der Leaflet-Karte zu platzieren */
            pointer-events: none; /* Deaktiviert Mausinteraktionen auf dem Canvas */
        }


        #layerControl {
            height: 80vh;
            width: 30%;
            float: left;
            padding: 10px;
            background-color: #f8f9fa;
            border-left: 1px solid #ddd;
        }

        #console {
            clear: both;
            position: relative;
            bottom: 0;
            background-color: white;
            opacity: 0.8;
            width: 100%;
            max-height: 150px;
            overflow-y: scroll;
            border-top: 1px solid black;
            font-family: monospace;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Layer Management Panel -->
    <div id="layerControl">
        <h3>Layer Management</h3>
        <ul id="layerList"></ul>
        <h4>Edit Layer</h4>
        <label for="layerName">Name:</label>
        <input type="text" id="layerName" placeholder="Layer Name"><br><br>
        <label for="layerColor">Color:</label>
        <input type="color" id="layerColor" value="#3388ff"><br><br>
        <button onclick="saveLayerChanges()">Save Changes</button>
    </div>

    <div id="console"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Leaflet Draw JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

    <!-- Proj4 and Proj4Leaflet for coordinate transformation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.12.1/proj4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.js"></script>

    <!-- Three.js for 3D visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Custom JS -->
    <script src="main.js"></script>
    <script src="layerControl.js"></script>
    <script src="geojsonHandler.js"></script>

    <script>
        // Funktion zum Logging in der eingebauten Konsole
        function logToConsole(message) {
            var consoleDiv = document.getElementById('console');
            consoleDiv.innerHTML += message + "<br>";
            consoleDiv.scrollTop = consoleDiv.scrollHeight; // Automatisch nach unten scrollen
        }

        // Passt console.log so an, dass mehrere Argumente verarbeitet werden
        console.log = function(...args) {  // Verwendet rest-Parameter, um mehrere Argumente zu akzeptieren
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
            logToConsole(message);
        };

        const test = "Test 1";

        logToConsole("Test message from inline script.", test);  // Dies sollte im Konsolenbereich angezeigt werden

    </script>

    <!-- WebChannel-Code für die Kommunikation mit Python -->
    <script src="qwebchannel.js"></script>
    <script>
        var geojsonExport = null;

        // Initialisiere QWebChannel und verbinde mit Python
        new QWebChannel(qt.webChannelTransport, function(channel) {
            window.pywebchannel = channel.objects.pywebchannel;
        });

    </script> 
</body>
</html>

