<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Leaflet.draw and CRS Support</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <style>
        #container {
            display: flex;
            height: 100vh;
        }

        #map {
            position: relative;
            height: 100%;
            width: 75%; /* Karte nimmt 75% der Breite ein */
        }

        #layerControl {
            width: 25%; /* Layermanagement nimmt 25% der Breite ein */
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 1px solid #ddd;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        #layerControl h3, #layerControl h4 {
            font-family: Arial, sans-serif;
            color: #333;
            margin-bottom: 10px;
        }

        #layerControl label {
            font-family: Arial, sans-serif;
            color: #555;
        }

        #layerControl input[type="text"], 
        #layerControl input[type="color"], 
        #layerControl input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        #layerControl button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-family: Arial, sans-serif;
        }

        #layerControl button:hover {
            background-color: #0056b3;
        }

        #layerList {
            list-style-type: none;
            padding: 0;
        }

        #layerList li {
            margin: 5px 0;
            font-family: Arial, sans-serif;
            color: #333;
        }

        /* Layer-Liste Darstellung */
        .layer-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            margin: 4px 0;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .layer-item.selected-layer {
            background-color: #e0f7fa;
            border-color: #00796b;
            font-weight: bold;
        }

        .color-indicator {
            width: 15px;
            height: 15px;
            margin-right: 10px;
            border-radius: 50%;
        }

        /* Kontextmen체 Styling */
        .context-menu {
            position: absolute;
            z-index: 1000;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
        }

        .context-menu div {
            padding: 5px 10px;
            cursor: pointer;
        }

        .context-menu div:hover {
            background-color: #f0f0f0;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000; /* Hoher z-index, um das Three.js-Canvas 체ber der Leaflet-Karte zu platzieren */
            pointer-events: none; /* Deaktiviert Mausinteraktionen auf dem Canvas */
        }

        #console {
            clear: both;
            position: relative;
            bottom: 0;
            background-color: white;
            opacity: 0.8;
            width: 100%;
            max-height: 150px;
            overflow-y: scroll;
            border-top: 1px solid black;
            font-family: monospace;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div id="container">
        <!-- Layermanagement Panel -->
        <div id="layerControl">
            <h3>Layer Management</h3>
            <ul id="layerList"></ul>
            <!-- Farbdialog -->
            <input type="color" id="colorPicker" style="display:none;" onchange="applyColorChange(this.value)">

            <!-- Opazit채tsdialog -->
            <input type="range" id="opacitySlider" style="display:none;" min="0" max="1" step="0.1" onchange="applyOpacityChange(this.value)">

        </div>
    
        <!-- Map Div -->
        <div id="map"></div>
    </div>
    

    <div id="console"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Leaflet Draw JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

    <!-- Proj4 and Proj4Leaflet for coordinate transformation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.12.1/proj4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.js"></script>

    <!-- Three.js for 3D visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Custom JS -->
    <script src="main.js"></script>
    <script src="layerControl.js"></script>
    <script src="geojsonHandler.js"></script>

    <script>
        // Funktion zum Logging in der eingebauten Konsole
        function logToConsole(message) {
            var consoleDiv = document.getElementById('console');
            consoleDiv.innerHTML += message + "<br>";
            consoleDiv.scrollTop = consoleDiv.scrollHeight; // Automatisch nach unten scrollen
        }

        // Passt console.log so an, dass mehrere Argumente verarbeitet werden
        console.log = function(...args) {  // Verwendet rest-Parameter, um mehrere Argumente zu akzeptieren
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
            logToConsole(message);
        };

        const test = "Test 1";

        logToConsole("Test message from inline script.", test);  // Dies sollte im Konsolenbereich angezeigt werden

    </script>

    <!-- WebChannel-Code f체r die Kommunikation mit Python -->
    <script src="qwebchannel.js"></script>
    <script>
        var geojsonExport = null;

        // Initialisiere QWebChannel und verbinde mit Python
        new QWebChannel(qt.webChannelTransport, function(channel) {
            window.pywebchannel = channel.objects.pywebchannel;
        });

    </script> 
</body>
</html>

