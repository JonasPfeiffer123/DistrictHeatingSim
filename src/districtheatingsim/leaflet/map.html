<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Leaflet.draw and CRS Support</title>
    
    <!-- Leaflet CSS - Latest Version -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!-- Leaflet Draw CSS - Latest Version -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <!-- Leaflet-Geoman CSS - Latest Version -->
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />

    <style>
        /* Gesamtcontainer */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* Verhindert Scrollen */
        }

        #container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* Hauptbereich für Karte und LayerControl nebeneinander */
        #mainContent {
            display: flex;
            flex-grow: 1;
            height: 100%; /* Volle Höhe ohne Konsole */
        }

        /* Layer Control links */
        #layerControl {
            width: 300px; /* Feste Breite für bessere Kontrolle */
            background-color: #f8f9fa;
            padding: 12px;
            border-right: 1px solid #ddd;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto; /* Scrollen nur innerhalb des LayerControl */
            display: flex;
            flex-direction: column;
        }

        /* Karte rechts */
        #map {
            flex: 1; /* Nimmt den restlichen Platz ein */
            height: 100%;
        }

        #layerControl h3, #layerControl h4 {
            font-family: Arial, sans-serif;
            color: #333;
            margin: 0 0 12px 0;
        }

        #layerControl h3 {
            font-size: 16px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        #layerControl h4 {
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        #layerControl label {
            font-family: Arial, sans-serif;
            color: #555;
        }

        #layerControl input[type="text"], 
        #layerControl input[type="color"], 
        #layerControl input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        #layerControl button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 12px;
            cursor: pointer;
            font-family: Arial, sans-serif;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 10px;
            width: 100%;
            transition: background-color 0.2s;
        }

        #layerControl button:hover {
            background-color: #0056b3;
        }

        #layerList {
            list-style-type: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
        }

        #layerList li {
            margin: 4px 0;
            font-family: Arial, sans-serif;
            color: #333;
            font-size: 13px;
        }

        /* Layer-Liste Darstellung */
        .layer-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 6px 8px;
            margin: 2px 0;
            border: 1px solid #ddd;
            background-color: #ffffff;
            border-radius: 3px;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .layer-item.selected-layer {
            background-color: #e0f7fa;
            border-color: #00796b;
            font-weight: 500;
        }

        .layer-item.active-layer {
            background-color: #c8e6c9;
            border: 2px solid #4CAF50;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(76, 175, 80, 0.3);
        }

        .layer-item:hover {
            background-color: #f5f5f5;
            border-color: #999;
        }

        .layer-visibility {
            margin-right: 6px;
            cursor: pointer;
            width: 14px;
            height: 14px;
        }

        .color-indicator {
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 50%;
            border: 1px solid #999;
            flex-shrink: 0;
        }

        .layer-name {
            flex-grow: 1;
            margin-right: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .lock-icon {
            margin-right: 6px;
            font-size: 12px;
            flex-shrink: 0;
        }

        .feature-count {
            font-size: 11px;
            color: #666;
            margin-left: 4px;
            flex-shrink: 0;
        }

        /* Kontextmenü Styling */
        .context-menu {
            position: absolute;
            z-index: 1000;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
        }

        .context-menu div {
            padding: 5px 10px;
            cursor: pointer;
        }

        .context-menu div:hover {
            background-color: #f0f0f0;
        }

        .overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            display: none;
        }

        #opacityControl {
            display: flex;
            align-items: center;
            gap: 10px; /* Abstand zwischen Slider und Button */
        }
    </style>
</head>
<body>
    <div id="container">
        <!-- Hauptbereich mit LayerControl und Karte -->
        <div id="mainContent">
            <div id="layerControl">
                <h3>Layer-Übersicht</h3>
                <ul id="layerList"></ul>
                <input type="color" id="colorPicker" style="display:none;" onchange="applyColorChange(this.value)">
                <div id="opacityControl" style="display:none;">
                    <input type="range" id="opacitySlider" min="0" max="1" step="0.1" onchange="applyOpacityChange(this.value)">
                    <button id="opacityOkButton">Ok</button>
                </div>
                <button id="createLayerButton" onclick="createNewLayer()">Neuen Layer erstellen</button>
                <button id="toggleMarkerButton">Marker setzen: Ein</button>
                <div id="coordinateDisplay" style="padding: 10px; background-color: #f8f9fa; font-family: Arial, sans-serif; font-size: 14px;">
                    Click on the map to get coordinates.
                </div>
            </div>
            <div id="map"></div>
        </div>
    </div>

    <!-- Leaflet JS - Latest Version -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Leaflet Draw JS - Latest Version -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

    <!-- Proj4 and Proj4Leaflet for coordinate transformation - Latest Versions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.12.1/proj4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.js"></script>

    <!-- Three.js for 3D visualization - Latest Version -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r170/three.min.js"></script>

    <!-- Leaflet-Geoman for advanced editing - Latest Version -->
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>

    <!-- Custom JS -->
    <script src="main.js"></script>
    <script src="layerControl.js"></script>
    <script src="geojsonHandler.js"></script>



    <!-- WebChannel-Code für die Kommunikation mit Python -->
    <script src="qwebchannel.js"></script>
    <script>
        new QWebChannel(qt.webChannelTransport, function(channel) {
        window.pywebview = channel.objects.geoJsonReceiver;
    });

    </script> 
</body>
</html>

